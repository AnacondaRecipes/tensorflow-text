From 357778b855d4c4f6bcc565ee5b18b77f26332097 Mon Sep 17 00:00:00 2001
From: Jack Olivieri <jolivieri@anaconda.com>
Date: Thu, 2 May 2024 21:36:01 +0200
Subject: [PATCH] add bazel flags for macos build

---
 oss_scripts/run_build.sh | 17 +++++++++++++++++
 1 file changed, 17 insertions(+)

diff --git a/oss_scripts/run_build.sh b/oss_scripts/run_build.sh
index d2114f6..f809cf9 100755
--- a/oss_scripts/run_build.sh
+++ b/oss_scripts/run_build.sh
@@ -14,6 +14,23 @@ fi
 # Run configure.
 source oss_scripts/configure.sh
 
+if [[ $osname == "darwin" ]]; then
+  cat >> .bazelrc <<EOF
+  build --verbose_failures
+  build --toolchain_resolution_debug 1
+  build --copt=-isysroot${CONDA_BUILD_SYSROOT}
+  build --copt=-mmacosx-version-min=${macos_min_version}
+  build --copt=-D_LIBCPP_ENABLE_CXX17_REMOVED_UNARY_BINARY_FUNCTION
+  build --host_copt=-isysroot${CONDA_BUILD_SYSROOT}
+  build --host_copt=-mmacosx-version-min=${macos_min_version}
+  build --host_copt=-D_LIBCPP_ENABLE_CXX17_REMOVED_UNARY_BINARY_FUNCTION
+  build --linkopt=-isysroot${CONDA_BUILD_SYSROOT}
+  build --linkopt=-mmacosx-version-min=${macos_min_version}
+  build --host_linkopt=-isysroot${CONDA_BUILD_SYSROOT}
+  build --host_linkopt=-mmacosx-version-min=${macos_min_version}
+EOF
+fi
+
 # Verify correct version of Bazel
 # installed_bazel_version=$(bazel version | grep label | sed -e 's/.*: //')
 # tf_bazel_version=$(cat .bazelversion)
-- 
2.39.3 (Apple Git-146)

